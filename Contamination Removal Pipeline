#Bacterial Removal


# run blastn against nucleotide databas
blob_blast.sh <contigs.fasta>

#assign taxonomy and parse for best match, assumes coverage known
blob_create_json.sh <contigs.fasta> <blob_blast_output> 

#construct list of non-bacterial nodes
awk -F'\t' '{if ($5 != " Bacteria ") print $1}' sample_a2.parsed.json > non_bacterial_nodes.txt
#or
awk -F'\t' '{if ($5 != " Bacteria ") print $1}' sample_a2.parsed.json > non_bacterial_nodes.txt

#to gather_list of non_bacteria_groups (or bacterial) do:

awk -F'\t' '{if ($5 != " Bacteria ") print $6;}' sample_a2.parsed.json | sort | uniq -c
#or
awk -F'\t' '{print $6}' sample_a2.parsed.json | sort | uniq -c

#to view all stuff about a group use, with group replaced with Arthropoda
awk -F'\t' '{if ($6 == " Arthropoda ") print $0;}' sample_a2.parsed.json | less -S

#generate fasta of wanted nodes
extract_nodes_exact_matches.py <contig_file> <node_list> [output_name]




######## See new script for read extraction


#map and extract mapped and unmapped reads
bowtie2

nohup bowtie2 --un-conc-gz sample_a8_new_reads/ --al-conc-gz sample_a8_new_reads/ --al-gz sample_a8_new_reads/ --un-gz sample_a8_new_reads/ -x ../ALL_CONTIGS/sample_at8 -1 ../READS/a8_1.fastq.gz -2 ../READS/a8_2.fastq.gz -p 20 -S sample_a8.sam &


#assemble as desired



####CHECK COVERAGE

samtools depth  *bamfile*  |  awk '{sum+=$3} END { print "Average = ",sum/NR}' #Replace NR with genome size for better estimate
